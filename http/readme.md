# CDN加速原理
如图所示  
![image](https://github.com/yanlongLv/notes/blob/main/http/CDN%20Global%20server%20load%20balance.jpg)
## CDN加速http请求流程
1. 用户在浏览器输入要访问的网站域名，向本地DNS发起域名解析请求。   
2. 用户在浏览器输入要访问的网站域名，向本地DNS发起域名解析请求。  
3. 网站DNS服务器解析发现域名已经CNAME到了。  
4. 请求被指向CDN GSLB DNS服务。  
5. CDN GSLB DNS对域名进行智能解析，将响应速度最快的CDN节点IP地址返回给本地DNS。
6. 用户获取响应速度最快的CDN节点IP地址。  
7. 浏览器在得到速度最快节点的IP地址以后，向CDN节点发出访问请求。  
8. CDN节点回源站拉取用户所需资源。  
9. 将回源拉取的资源缓存至节点。 
10. 将用户所需资源返回给用户。 
# 全局负载均衡（Global Sever Load Balance )
GSLB 最常见的实现方式是“DNS 负载均衡”,原来没有 CDN 的时候，权威 DNS 返回的是网站自己服务器的实际 IP 地址，浏览器收到 DNS 解析结果后直连网站。  
但加入 CDN 后就不一样了，权威 DNS 返回的不是 IP 地址，而是一个 CNAME( Canonical Name ) 别名记录，指向的就是 CDN 的 GSLB。  
因为没拿到 IP 地址，于是本地 DNS 就会向 GSLB 再发起请求，这样就进入了 CDN 的全局负载均衡系统，开始“智能调度”，主要的依据有这么几个：
1. 看用户的 IP 地址，查表得知地理位置，找相对最近的边缘节点；
2. 看用户所在的运营商网络，找相同网络的边缘节点；
3. 检查边缘节点的负载情况，找负载较轻的节点；
4. 其他，比如节点的“健康状况”、服务能力、带宽、响应时间等。GSLB 把这些因素综合起来，用一个复杂的算法，最后找出一台“最合适”的边缘节点，把这个节点的 IP 地址返回给用户，用户就可以“就近”访问 CDN 的缓存代理了。